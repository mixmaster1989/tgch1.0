## MEXCAITRADE — как работает система

Проект — это автономный спот‑трейдинг на бирже MEXC с уведомлениями в Telegram. Точка входа — `main.py`, который оркестрирует независимые сервисы в отдельных потоках.

### Архитектура
- **Точка входа**: `main.py` — запускает ключевые сервисы и обрабатывает их жизненный цикл.
- **Слой API**:
  - `mex_api.py` — базовые REST вызовы (цены, свечи, балансы, ордера, стакан, тикеры)
  - `mexc_advanced_api.py` — правила лотов/точностей, комиссии, история сделок, минимальные нотионалы
- **Конфигурация**: `config.py` — ключи MEXC и Telegram, торговые параметры, исключённые символы, `PNL_MONITOR_CONFIG`.

### Основные сервисы
- **MarketScanner** (`market_scanner.py`)
  - Сканирует USDT‑рынки, считает технические индикаторы (`technical_indicators.py`), применяет анти‑хайп фильтр (`anti_hype_filter.py`).
  - Формирует возможности для покупки и совершает автопокупку на часть USDT‑баланса.
  - Отправляет краткие отчёты в Telegram.

- **BalanceMonitor** (`balance_monitor.py`)
  - Покупает BTC/ETH за USDC с защитами: минимальный остаток, максимальная сумма сделки, кулдауны.
  - Работает лимитными ордерами около рынка (часто как мейкер), использует фильтры (`anti_hype_filter.py`, `rebalancer_anti_hype_filter.py`).
  - Периодические уведомления в Telegram.

- **PnLMonitor** (`pnl_monitor.py`)
  - Вычисляет PnL по BTC/ETH через историю сделок (`mexc_advanced_api.get_my_trades`).
  - При достижении порога прибыли продаёт лимитным ордером чуть ниже рынка и шлёт уведомление.
  - Может вызывать пост‑балансировку свободных стейблов (`post_sale_balancer.py`).

- **Active5050Balancer** (`active_50_50_balancer.py`)
  - Поддерживает ~50/50 между Альтами и BTC/ETH, оперируя USDC (минимумы, кулдауны, резерв USDC).
  - Использует `portfolio_balancer.py` для расчётов.

- **AltsMonitor** (`alt_monitor.py`)
  - Отслеживает «дешёвые» альты, применяет фильтры и может инициировать покупки через `Active5050Balancer`.

- **StablecoinBalancer** (`stablecoin_balancer.py`)
  - Балансирует USDT/USDC при явном дисбалансе, оставляя резерв под операции BTC/ETH.
  - Может вызываться вручную (`utils/run_stablecoin_balance.py`) или интегрироваться по требованию.

- **StartupDashboard** (`startup_dashboard.py`)
  - Отправляет стартовое уведомление в Telegram при запуске бота.

Дополнительно: **PortfolioAnalyzer** (`portfolio_analyzer.py`) формирует полный отчёт об аккаунте и P&L и отправляет в Telegram (используется по требованию, не является обязательной частью рантайма).

### Поведение и защиты
- Минимальные суммы покупки соблюдают биржевые требования; точности и шаги — через `mexc_advanced_api.py`.
- Кулдауны между операциями, защита минимального остатка USDC.
- Анти‑хайп фильтры снижают активность в «шумных» условиях.
- Анти‑спам: частота Telegram‑отчётов ограничена.

### Требования
- Python 3.10+
- Доступ к интернету (MEXC REST API, Telegram Bot API)

### Конфигурация
- Все параметры берутся из `config.py`. Секреты и переменные окружения считываются кодом; вручную `.env` не редактировать.
  - **MEXC**: ключ/секрет
  - **Telegram**: `TELEGRAM_BOT_TOKEN`, `TELEGRAM_CHAT_ID`
  - Торговые параметры: `PNL_MONITOR_CONFIG`, исключённые символы и пр.

### Запуск
- Рекомендованный способ — через PM2 (процесс `mexc`). Он запускает `python3 main.py` из каталога проекта.
  - Проверка статуса: `pm2 status`
  - Логи процесса: `pm2 logs mexc | cat`

Локальный запуск (без PM2) при необходимости:
```bash
python3 main.py
```

### Логи и уведомления
- Большинство сервисов печатает ключевые события в stdout/stderr (собираются PM2) и отправляет критичные события в Telegram.

### Структура проекта (важное)
- Корень: основные рантайм‑модули (`main.py`, мониторинги, балансировщики, API‑клиенты, `config.py`).
- `utils/`: вспомогательные одноразовые/диагностические скрипты.
- `tests/`: тестовые скрипты.
- `archive/`, `backups/`: архивные версии и бэкапы.

### Типичные сценарии
- Свободные USDC ≥ порога → `BalanceMonitor` покупает BTC/ETH (60/40).
- Найдены сильные альт‑сигналы → `MarketScanner` покупает в USDT‑рынках.
- BTC/ETH в профите > порога → `PnLMonitor` продаёт и при необходимости балансирует стейблы.
- Отклонение портфеля от 50/50 > порога → `Active5050Balancer` корректирует распределение через USDC.

### Тревога и диагностика
- Проверяйте логи PM2 и Telegram‑уведомления для анализа причин (отказы API, ограничения лота, фильтры, кулдауны).


