#!/bin/bash
"""
–°–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞—Ç—É—Å–∞ —Ç–æ—Ä–≥–æ–≤–æ–≥–æ –±–æ—Ç–∞
"""

PID_FILE="trading_bot.pid"
LOG_FILE="logs/trading_bot.log"

echo "üìä –°–¢–ê–¢–£–° –¢–û–†–ì–û–í–û–ì–û –ë–û–¢–ê"
echo "========================"

# –ü—Ä–æ–≤–µ—Ä—è–µ–º PID —Ñ–∞–π–ª
if [ -f "$PID_FILE" ]; then
    PID=$(cat "$PID_FILE")
    echo "üÜî PID —Ñ–∞–π–ª: $PID"
    
    if ps -p $PID > /dev/null 2>&1; then
        echo "‚úÖ –ë–æ—Ç –ó–ê–ü–£–©–ï–ù (PID: $PID)"
        
        # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø—Ä–æ—Ü–µ—Å—Å–µ
        echo ""
        echo "üìã –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–æ—Ü–µ—Å—Å–µ:"
        ps -p $PID -o pid,ppid,cmd,etime,pcpu,pmem
        
        # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ –ª–æ–≥–∏
        if [ -f "$LOG_FILE" ]; then
            echo ""
            echo "üìù –ü–æ—Å–ª–µ–¥–Ω–∏–µ 10 —Å—Ç—Ä–æ–∫ –ª–æ–≥–æ–≤:"
            echo "----------------------------------------"
            tail -10 "$LOG_FILE"
            echo "----------------------------------------"
        fi
        
    else
        echo "‚ùå –ë–æ—Ç –ù–ï –ó–ê–ü–£–©–ï–ù (–ø—Ä–æ—Ü–µ—Å—Å –Ω–µ –Ω–∞–π–¥–µ–Ω)"
        echo "üóëÔ∏è –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–π PID —Ñ–∞–π–ª..."
        rm -f "$PID_FILE"
    fi
else
    echo "‚ùå PID —Ñ–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω"
fi

echo ""
echo "üîç –ü–æ–∏—Å–∫ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –ø–æ –∏–º–µ–Ω–∏..."
PIDS=$(pgrep -f "run_auto_trader.py")
if [ ! -z "$PIDS" ]; then
    echo "‚úÖ –ù–∞–π–¥–µ–Ω—ã –ø—Ä–æ—Ü–µ—Å—Å—ã: $PIDS"
    for pid in $PIDS; do
        echo "  PID $pid: $(ps -p $pid -o cmd --no-headers)"
    done
else
    echo "‚ùå –ü—Ä–æ—Ü–µ—Å—Å—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã"
fi

echo ""
echo "üì± –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Telegram –¥–ª—è –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π" 