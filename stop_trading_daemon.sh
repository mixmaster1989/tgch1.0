#!/bin/bash
"""
–°–∫—Ä–∏–ø—Ç –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ —Ç–æ—Ä–≥–æ–≤–æ–≥–æ –±–æ—Ç–∞
"""

PID_FILE="trading_bot.pid"

echo "üõë –û–°–¢–ê–ù–û–í–ö–ê –¢–û–†–ì–û–í–û–ì–û –ë–û–¢–ê"
echo "============================"

if [ -f "$PID_FILE" ]; then
    PID=$(cat "$PID_FILE")
    echo "üìã –ù–∞–π–¥–µ–Ω PID: $PID"
    
    if ps -p $PID > /dev/null 2>&1; then
        echo "üîÑ –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞..."
        kill $PID
        
        # –ñ–¥–µ–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
        sleep 2
        
        if ps -p $PID > /dev/null 2>&1; then
            echo "‚ö†Ô∏è –ü—Ä–æ—Ü–µ—Å—Å –Ω–µ –æ—Å—Ç–∞–Ω–æ–≤–∏–ª—Å—è, –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞..."
            kill -9 $PID
        fi
        
        echo "‚úÖ –ë–æ—Ç –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
    else
        echo "‚ö†Ô∏è –ü—Ä–æ—Ü–µ—Å—Å —É–∂–µ –Ω–µ –∑–∞–ø—É—â–µ–Ω"
    fi
    
    # –£–¥–∞–ª—è–µ–º PID —Ñ–∞–π–ª
    rm -f "$PID_FILE"
    echo "üóëÔ∏è PID —Ñ–∞–π–ª —É–¥–∞–ª–µ–Ω"
    
else
    echo "‚ùå PID —Ñ–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω"
    echo "–ü–æ–ø—ã—Ç–∫–∞ –Ω–∞–π—Ç–∏ –ø—Ä–æ—Ü–µ—Å—Å –ø–æ –∏–º–µ–Ω–∏..."
    
    # –ò—â–µ–º –ø—Ä–æ—Ü–µ—Å—Å –ø–æ –∏–º–µ–Ω–∏
    PIDS=$(pgrep -f "run_auto_trader.py")
    if [ ! -z "$PIDS" ]; then
        echo "üîç –ù–∞–π–¥–µ–Ω—ã –ø—Ä–æ—Ü–µ—Å—Å—ã: $PIDS"
        for pid in $PIDS; do
            echo "üîÑ –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞ $pid..."
            kill $pid
        done
        echo "‚úÖ –í—Å–µ –ø—Ä–æ—Ü–µ—Å—Å—ã –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã"
    else
        echo "‚ùå –ü—Ä–æ—Ü–µ—Å—Å—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã"
    fi
fi

echo ""
echo "üìä –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Telegram –¥–ª—è —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ –æ—Ç—á–µ—Ç–∞" 